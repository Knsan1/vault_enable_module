Hereâ€™s a refined version of the `README.md` for the main module and output configurations, covering both the `vault-aws-auth-backend` and `jwt-auth-backend` modules.

---

# Vault AWS and JWT Authentication Backends

This repository contains Terraform modules for configuring AWS and JWT authentication backends in Vault. The primary module, `vault-aws-auth-backend`, sets up AWS-based authentication, allowing EC2 instances and IAM users to interact with Vault securely. Additionally, the `jwt-auth-backend` module configures JWT-based authentication for workloads that rely on JWT tokens for access to Vault.

## Prerequisites

Before using these modules, ensure that the following are set up:
- **Vault** with a running instance.
- **Enable AWS Secret Engine** to provide IAM User with Admin Permission
- **Terraform** CLI installed.

## Modules Overview

### 1. Vault AWS Authentication Backend

This module creates resources to enable Vault AWS authentication, set up IAM users, roles, and associate Vault policies. The AWS authentication backend allows EC2 instances or IAM users to authenticate with Vault using their AWS credentials.

#### Example Usage:

```hcl
provider "vault" {
  address = "http://192.168.56.87:8200"
  token   = "xxxxxxxxxx"
}

module "vault-aws-auth" {
  source = "../modules/vault-aws-auth-backend"

  user_name             = "vault-auth-admin"
  policy_name           = "vault-auth-policy"
  actions               = ["ec2:DescribeInstances", "iam:GetInstanceProfile", "iam:GetUser", "iam:ListRoles", "iam:GetRole"]
  ec2_role_name         = "AWS_EC2_role"
  instance_profile_name = "vault-client-instance-profile"
  vault_policy_name     = "ec2-policy"
  vault_policy_document = <<EOT
  # Vault policy definition
  path "auth/token/lookup-self" {
    capabilities = ["read"]
  }
  # Additional policy paths
  EOT

  vault_role_name = "ec2-role"
  token_ttl       = 300
  token_max_ttl   = 600
}
```

### 2. Vault JWT Authentication Backend

This module configures Vault's JWT authentication backend, enabling workloads using JWT tokens (e.g., applications on Terraform Cloud) to authenticate and interact with Vault.

#### Example Usage:

```hcl
module "enable_vault_jwt_auth_backend" {
  source             = "../modules/vault-jwt-auth-backend-tfc"
  description        = "JWT Auth Backend for Terraform Cloud"
  path               = "jwt"
  oidc_discovery_url = "https://app.terraform.io"
  bound_issuer       = "https://app.terraform.io"
  policy_name        = "admin-policy"
  role_name          = "admin-role"
  bound_audiences    = ["vault.workload.identity"]
  bound_claims_type  = "glob"
  bound_claims = {
    sub = "organization:Hellocloud-kns:project:HCP Vault Project:workspace:*:run_phase:*"
  }
  user_claim = "terraform_full_workspace"
  role_type  = "jwt"
  token_ttl  = 1200
}
```

## Inputs

### Vault AWS Authentication Backend (`vault-aws-auth-backend`)

| Name                   | Description                                                              | Type     | Default        | Required |
|------------------------|--------------------------------------------------------------------------|----------|----------------|----------|
| `user_name`             | The name of the IAM user created for Vault AWS authentication.            | `string` | n/a            | yes      |
| `policy_name`           | The name of the policy attached to the IAM user.                          | `string` | n/a            | yes      |
| `actions`               | The list of AWS IAM actions allowed for the policy.                      | `list`   | n/a            | yes      |
| `ec2_role_name`         | The name of the IAM role assigned to EC2 instances for Vault interaction. | `string` | n/a            | yes      |
| `instance_profile_name` | The instance profile name for EC2 IAM role.                               | `string` | n/a            | yes      |
| `vault_policy_name`     | The name of the Vault policy associated with this role.                   | `string` | n/a            | yes      |
| `vault_policy_document` | The Vault policy document used to configure access rules.                 | `string` | n/a            | yes      |
| `vault_role_name`       | The Vault AWS role name tied to the policy.                               | `string` | n/a            | yes      |
| `token_ttl`             | Time to live for the token generated by Vault.                            | `number` | 300            | no       |
| `token_max_ttl`         | Maximum time to live for the Vault token.                                 | `number` | 600            | no       |

### Vault JWT Authentication Backend (`jwt-auth-backend`)

| Name                   | Description                                                                                 | Type     | Default                        | Required |
|------------------------|---------------------------------------------------------------------------------------------|----------|--------------------------------|----------|
| `description`           | Description for the JWT auth backend.                                                       | `string` | n/a                            | yes      |
| `path`                  | The path where the JWT auth backend is enabled in Vault.                                     | `string` | n/a                            | yes      |
| `oidc_discovery_url`    | The OpenID Connect discovery URL for JWT tokens.                                             | `string` | n/a                            | yes      |
| `bound_issuer`          | The expected issuer of the JWT token.                                                        | `string` | n/a                            | yes      |
| `policy_name`           | The policy attached to the JWT role in Vault.                                                | `string` | n/a                            | yes      |
| `role_name`             | The name of the role in Vault's JWT auth backend.                                            | `string` | n/a                            | yes      |
| `bound_audiences`       | The audience(s) of the JWT token.                                                            | `list`   | n/a                            | yes      |
| `bound_claims`          | Bound claims to validate the JWT token.                                                      | `map`    | n/a                            | yes      |
| `user_claim`            | The claim to extract the username from within the JWT token.                                  | `string` | n/a                            | yes      |
| `role_type`             | The role type for JWT authentication.                                                        | `string` | jwt                            | no       |
| `token_ttl`             | The TTL for tokens issued by the JWT auth backend.                                            | `number` | 1200                           | no       |

## Outputs

### Vault AWS Authentication Backend

| Name            | Description                                                                   |
|-----------------|-------------------------------------------------------------------------------|
| `iam_user_name` | The name of the IAM user created for Vault AWS authentication.                |
| `ec2_role_name` | The name of the IAM role created for EC2 instances to interact with Vault.    |
| `vault_role_name`| The name of the Vault AWS authentication backend role configured for the IAM role.|

### Vault JWT Authentication Backend

| Name                   | Description                                                       |
|------------------------|-------------------------------------------------------------------|
| `jwt_auth_backend_path` | The path where the JWT auth backend is enabled in Vault.          |
| `jwt_role_name`         | The name of the role created for the JWT authentication backend.  |
| `jwt_openid_claim`      | The OpenID claim used to validate the JWT token.                  |
